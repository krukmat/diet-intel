<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DietIntel Backend Test Coverage Improvement Plan</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #2980b9;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        h3 {
            color: #34495e;
            margin-top: 25px;
        }
        .phase {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .phase h3 {
            margin-top: 0;
            color: #495057;
        }
        .priority-critical {
            border-left: 5px solid #e74c3c;
            background: #fdf2f2;
        }
        .priority-high {
            border-left: 5px solid #f39c12;
            background: #fef9e7;
        }
        .priority-medium {
            border-left: 5px solid #f1c40f;
            background: #fffbf0;
        }
        .priority-low {
            border-left: 5px solid #27ae60;
            background: #f0f8f0;
        }
        .coverage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #ffffff;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        pre {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-size: 0.9em;
        }
        code {
            background: #f8f8f8;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .timeline {
            border-left: 3px solid #3498db;
            padding-left: 20px;
            margin: 20px 0;
        }
        .timeline-item {
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .timeline-week {
            font-weight: bold;
            color: #2980b9;
        }
        .success-metrics {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .coverage-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .coverage-category {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        .coverage-high {
            background: #d1ecf1;
            border-color: #bee5eb;
        }
        .coverage-medium {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
        .coverage-low {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .coverage-zero {
            background: #f6f6f6;
            border-color: #dee2e6;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .emoji {
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="emoji">üéØ</span> DietIntel Backend Test Coverage Improvement Plan</h1>
        
        <h2><span class="emoji">üìã</span> Strategic Overview</h2>
        <div class="coverage-stats">
            <div class="stat-card">
                <div class="stat-number">32%</div>
                <div class="stat-label">Current Coverage</div>
                <div style="color: #666; font-size: 0.8em;">727/2,259 lines</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">70%</div>
                <div class="stat-label">Target Coverage</div>
                <div style="color: #666; font-size: 0.8em;">~1,580 lines</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">213</div>
                <div class="stat-label">Passing Tests</div>
                <div style="color: #666; font-size: 0.8em;">72% pass rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">78</div>
                <div class="stat-label">Failing Tests</div>
                <div style="color: #666; font-size: 0.8em;">Need fixes</div>
            </div>
        </div>

        <h2><span class="emoji">üìä</span> Current Coverage Breakdown</h2>
        <div class="coverage-breakdown">
            <div class="coverage-category coverage-high">
                <h4><span class="emoji">üü¢</span> High Coverage (>90%)</h4>
                <ul>
                    <li><code>app/models/meal_plan.py</code>: <strong>99%</strong> (111/112 lines)</li>
                    <li><code>app/models/product.py</code>: <strong>100%</strong> (38/38 lines)</li>
                    <li><code>app/models/user.py</code>: <strong>100%</strong> (63/63 lines)</li>
                    <li><code>app/models/reminder.py</code>: <strong>100%</strong> (31/31 lines)</li>
                    <li><code>app/models/tracking.py</code>: <strong>100%</strong> (45/45 lines)</li>
                </ul>
            </div>
            
            <div class="coverage-category coverage-medium">
                <h4><span class="emoji">üü°</span> Medium Coverage (25-40%)</h4>
                <ul>
                    <li><code>app/services/cache.py</code>: <strong>38%</strong> (15/40 lines)</li>
                    <li><code>app/services/database.py</code>: <strong>37%</strong> (44/119 lines)</li>
                    <li><code>app/services/openfoodfacts.py</code>: <strong>33%</strong> (16/48 lines)</li>
                    <li><code>app/services/barcode_lookup.py</code>: <strong>30%</strong> (81/268 lines)</li>
                    <li><code>app/services/nutrition_calculator.py</code>: <strong>30%</strong> (13/44 lines)</li>
                    <li><code>app/services/auth.py</code>: <strong>29%</strong> (35/120 lines)</li>
                    <li><code>app/services/ocr.py</code>: <strong>27%</strong> (27/101 lines)</li>
                </ul>
            </div>
            
            <div class="coverage-category coverage-low">
                <h4><span class="emoji">üî¥</span> Low Coverage (<25%)</h4>
                <ul>
                    <li><code>app/routes/product.py</code>: <strong>25%</strong> (32/126 lines)</li>
                    <li><code>app/routes/plan.py</code>: <strong>23%</strong> (19/83 lines)</li>
                    <li><code>app/routes/track.py</code>: <strong>21%</strong> (25/118 lines)</li>
                    <li><code>app/routes/reminder.py</code>: <strong>17%</strong> (22/130 lines)</li>
                    <li><code>app/services/meal_planner.py</code>: <strong>13%</strong> (21/167 lines)</li>
                    <li><code>app/services/plan_storage.py</code>: <strong>22%</strong> (18/81 lines)</li>
                    <li><code>app/services/plan_customizer.py</code>: <strong>14%</strong> (21/147 lines)</li>
                </ul>
            </div>
            
            <div class="coverage-category coverage-zero">
                <h4><span class="emoji">‚ö´</span> Zero Coverage</h4>
                <ul>
                    <li><code>app/services/nutrition_ocr.py</code>: <strong>0%</strong> (0/270 lines)</li>
                </ul>
            </div>
        </div>

        <h2><span class="emoji">üöÄ</span> Implementation Phases</h2>

        <!-- Phase 1: OCR Service -->
        <div class="phase priority-critical">
            <h3><span class="emoji">üî¥</span> Phase 1: OCR Service Coverage (0% ‚Üí 70%)</h3>
            <p><strong>Priority: CRITICAL</strong> - 270 lines of zero coverage</p>
            
            <h4>1.1 OCR Core Testing</h4>
            <pre><code># tests/test_nutrition_ocr_comprehensive.py
- test_extract_text_from_image()
- test_image_preprocessing_pipeline()
- test_confidence_scoring_algorithm()
- test_tesseract_integration()
- test_opencv_image_enhancement()</code></pre>

            <h4>1.2 Nutrition Parsing Tests</h4>
            <pre><code># tests/test_nutrition_parsing.py
- test_parse_nutrition_facts_table()
- test_extract_calories_per_100g()
- test_parse_protein_fat_carbs()
- test_handle_missing_nutrition_fields()
- test_unit_conversion_logic()</code></pre>

            <h4>1.3 OCR Error Handling</h4>
            <pre><code># tests/test_ocr_error_scenarios.py
- test_corrupted_image_handling()
- test_low_quality_image_processing()
- test_tesseract_timeout_handling()
- test_unsupported_image_format()
- test_memory_exhaustion_scenarios()</code></pre>

            <p><strong>Estimated Impact</strong>: +189 lines covered (270 √ó 70%)</p>
        </div>

        <!-- Phase 2: Authentication -->
        <div class="phase priority-high">
            <h3><span class="emoji">üü°</span> Phase 2: Authentication Coverage (29% ‚Üí 80%)</h3>
            <p><strong>Priority: HIGH</strong> - Security-critical functionality</p>

            <h4>2.1 JWT Token Management</h4>
            <pre><code># tests/test_auth_jwt.py
- test_generate_access_token()
- test_generate_refresh_token()
- test_token_expiration_validation()
- test_token_signature_verification()
- test_invalid_token_rejection()</code></pre>

            <h4>2.2 User Registration & Login</h4>
            <pre><code># tests/test_auth_flows.py
- test_user_registration_success()
- test_password_hashing_verification()
- test_email_validation_logic()
- test_developer_code_validation()
- test_duplicate_email_prevention()</code></pre>

            <h4>2.3 Authentication Routes</h4>
            <pre><code># tests/test_auth_routes.py
- test_register_endpoint_success()
- test_login_endpoint_success()
- test_refresh_token_endpoint()
- test_logout_endpoint()
- test_protected_route_access()</code></pre>

            <p><strong>Estimated Impact</strong>: +61 lines covered (120 √ó 51%)</p>
        </div>

        <!-- Phase 3: Meal Planning -->
        <div class="phase priority-high">
            <h3><span class="emoji">üü†</span> Phase 3: Meal Planning Coverage (13% ‚Üí 60%)</h3>
            <p><strong>Priority: HIGH</strong> - Core business logic</p>

            <h4>3.1 Meal Generation Algorithm</h4>
            <pre><code># tests/test_meal_generation.py
- test_bmr_tdee_calculations()
- test_calorie_distribution_logic()
- test_product_selection_algorithm()
- test_meal_optimization_constraints()
- test_flexibility_mode_behavior()</code></pre>

            <h4>3.2 Nutrition Calculations</h4>
            <pre><code># tests/test_nutrition_calculations.py
- test_macro_percentage_calculations()
- test_serving_size_scaling()
- test_daily_targets_computation()
- test_meal_item_macro_aggregation()
- test_nutritional_completeness_scoring()</code></pre>

            <h4>3.3 Plan Customization</h4>
            <pre><code># tests/test_plan_customization.py
- test_add_item_to_meal()
- test_remove_item_from_meal()
- test_swap_meal_items()
- test_adjust_serving_sizes()
- test_regenerate_meal_plan()</code></pre>

            <p><strong>Estimated Impact</strong>: +78 lines covered (167 √ó 47%)</p>
        </div>

        <!-- Phase 4: API Routes -->
        <div class="phase priority-medium">
            <h3><span class="emoji">üîµ</span> Phase 4: API Routes Coverage (17-25% ‚Üí 70%)</h3>
            <p><strong>Priority: MEDIUM</strong> - User-facing functionality</p>

            <h4>4.1 Product Routes Enhancement</h4>
            <pre><code># tests/test_product_routes_complete.py
- test_barcode_lookup_success_path()
- test_scan_label_upload_handling()
- test_external_ocr_fallback_logic()
- test_cache_hit_miss_scenarios()
- test_rate_limiting_behavior()</code></pre>

            <h4>4.2 Tracking Routes</h4>
            <pre><code># tests/test_tracking_routes_complete.py
- test_meal_tracking_workflow()
- test_weight_tracking_with_photos()
- test_progress_history_retrieval()
- test_photo_log_management()
- test_data_export_functionality()</code></pre>

            <h4>4.3 Reminder Routes</h4>
            <pre><code># tests/test_reminder_routes_complete.py
- test_create_meal_reminders()
- test_weight_tracking_reminders()
- test_recurring_reminder_logic()
- test_reminder_notification_timing()
- test_reminder_deactivation()</code></pre>

            <h4>4.4 Plan Routes</h4>
            <pre><code># tests/test_plan_routes_complete.py
- test_generate_plan_endpoint()
- test_customize_plan_endpoint()
- test_save_plan_persistence()
- test_plan_sharing_functionality()
- test_plan_history_management()</code></pre>

            <p><strong>Estimated Impact</strong>: +284 lines covered</p>
        </div>

        <!-- Phase 5: Service Layer -->
        <div class="phase priority-low">
            <h3><span class="emoji">üü¢</span> Phase 5: Service Layer Improvements</h3>
            <p><strong>Priority: LOW</strong> - Supporting infrastructure</p>

            <h4>5.1 Database Service Enhancement</h4>
            <pre><code># tests/test_database_comprehensive.py
- test_connection_pool_management()
- test_transaction_rollback_scenarios()
- test_migration_compatibility()
- test_query_optimization_paths()
- test_connection_recovery_logic()</code></pre>

            <h4>5.2 Cache Service Expansion</h4>
            <pre><code># tests/test_cache_advanced.py
- test_cache_eviction_policies()
- test_distributed_cache_scenarios()
- test_cache_warming_strategies()
- test_cache_invalidation_patterns()
- test_memory_pressure_handling()</code></pre>

            <p><strong>Estimated Impact</strong>: +45 lines covered</p>
        </div>

        <h2><span class="emoji">üìÖ</span> Implementation Timeline</h2>
        <div class="timeline">
            <div class="timeline-item">
                <div class="timeline-week">Week 1-2: OCR Service (Critical Path)</div>
                <ul>
                    <li>Set up Tesseract test fixtures</li>
                    <li>Create image processing test suite</li>
                    <li>Implement nutrition parsing tests</li>
                    <li><strong>Target: 189 lines covered</strong></li>
                </ul>
            </div>

            <div class="timeline-item">
                <div class="timeline-week">Week 3-4: Authentication Security</div>
                <ul>
                    <li>JWT token management tests</li>
                    <li>Registration/login flow tests</li>
                    <li>Security vulnerability tests</li>
                    <li><strong>Target: 61 lines covered</strong></li>
                </ul>
            </div>

            <div class="timeline-item">
                <div class="timeline-week">Week 5-6: Meal Planning Logic</div>
                <ul>
                    <li>Algorithm correctness tests</li>
                    <li>Business logic validation</li>
                    <li>Optimization constraint tests</li>
                    <li><strong>Target: 78 lines covered</strong></li>
                </ul>
            </div>

            <div class="timeline-item">
                <div class="timeline-week">Week 7-8: API Route Coverage</div>
                <ul>
                    <li>Endpoint behavior tests</li>
                    <li>Error scenario coverage</li>
                    <li>Integration test expansion</li>
                    <li><strong>Target: 284 lines covered</strong></li>
                </ul>
            </div>

            <div class="timeline-item">
                <div class="timeline-week">Week 9: Service Layer Polish</div>
                <ul>
                    <li>Database reliability tests</li>
                    <li>Cache performance tests</li>
                    <li><strong>Target: 45 lines covered</strong></li>
                </ul>
            </div>
        </div>

        <h2><span class="emoji">üéØ</span> Expected Outcomes</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Current</th>
                    <th>Target</th>
                    <th>Improvement</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Coverage</td>
                    <td>32% (727 lines)</td>
                    <td>61% (1,384 lines)</td>
                    <td>+657 lines</td>
                </tr>
                <tr>
                    <td>OCR Service</td>
                    <td>0%</td>
                    <td>70%</td>
                    <td>+189 lines</td>
                </tr>
                <tr>
                    <td>Authentication</td>
                    <td>29%</td>
                    <td>80%</td>
                    <td>+61 lines</td>
                </tr>
                <tr>
                    <td>Meal Planning</td>
                    <td>13%</td>
                    <td>60%</td>
                    <td>+78 lines</td>
                </tr>
                <tr>
                    <td>API Routes</td>
                    <td>17-25%</td>
                    <td>70%</td>
                    <td>+284 lines</td>
                </tr>
                <tr>
                    <td>Service Layer</td>
                    <td>25-40%</td>
                    <td>50-60%</td>
                    <td>+45 lines</td>
                </tr>
            </tbody>
        </table>

        <div class="success-metrics">
            <h3><span class="emoji">‚úÖ</span> Success Metrics</h3>
            <ul>
                <li><strong>Zero-coverage modules eliminated</strong> - No more 0% coverage files</li>
                <li><strong>Security-critical paths fully tested</strong> - 90% authentication coverage</li>
                <li><strong>Core business logic validated</strong> - 70% meal planning coverage</li>
                <li><strong>API reliability guaranteed</strong> - 70% route coverage</li>
                <li><strong>CI/CD pipeline stability improved</strong> - Reduced test failures</li>
            </ul>
        </div>

        <h2><span class="emoji">üîß</span> Key Improvements Applied</h2>
        <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 20px 0;">
            <h4>Fixes Already Implemented:</h4>
            <ul>
                <li><strong>Product Endpoint Tests</strong>: Fixed AsyncMock usage (4/5 tests passing)</li>
                <li><strong>Model Validation</strong>: Corrected Pydantic field name mismatches</li>
                <li><strong>Test Infrastructure</strong>: Proper async/await patterns for cache services</li>
                <li><strong>Coverage Tracking</strong>: Added coverage/ directories to .gitignore</li>
            </ul>
        </div>

        <h2><span class="emoji">üìù</span> Notes</h2>
        <p>This plan prioritizes the most critical gaps while building a sustainable testing foundation. The phased approach ensures you tackle security and business logic first, then expand to comprehensive API coverage. Each phase includes specific test files, functions, and coverage targets to guide implementation.</p>

        <p><em>Generated on: <span id="currentDate"></span></em></p>
        <p><em>Project: DietIntel Backend Test Coverage Improvement</em></p>
    </div>

    <script>
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString();
    </script>
</body>
</html>