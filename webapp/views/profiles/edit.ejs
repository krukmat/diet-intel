<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - <%= profile.handle %></title>
    <link rel="stylesheet" href="/stylesheets/main.css">
</head>
<body>
    <%- include('../partials/header') %>

    <div class="container">
        <div class="edit-profile-container">
            <h1>Edit Profile</h1>

            <% if (typeof error !== 'undefined') { %>
                <div class="alert alert-error">
                    <%= error %>
                </div>
            <% } %>

            <form action="/profiles/me" method="POST" class="profile-edit-form">
                <div class="form-group">
                    <label for="handle">Handle (@username)</label>
                    <input
                        type="text"
                        id="handle"
                        name="handle"
                        value="<%= profile.handle %>"
                        placeholder="your_handle"
                        pattern="[a-z0-9_]{3,30}"
                        title="3-30 characters, letters, numbers and underscores only"
                        required
                    >
                    <small>3-30 characters (letters, numbers, underscores)</small>
                </div>

                <div class="form-group">
                    <label for="bio">Bio</label>
                    <textarea
                        id="bio"
                        name="bio"
                        maxlength="280"
                        rows="4"
                        placeholder="Tell others about yourself..."
                    ><%= profile.bio || '' %></textarea>
                    <div class="char-counter">
                        <span id="char-count">0</span>/280
                    </div>
                </div>

                <div class="form-group">
                    <label for="visibility">Profile Visibility</label>
                    <select id="visibility" name="visibility">
                        <option value="public" <%= profile.visibility === 'public' ? 'selected' : '' %>>Public</option>
                        <option value="followers_only" <%= profile.visibility === 'followers_only' ? 'selected' : '' %>>Followers Only</option>
                    </select>
                    <small>Public: Anyone can see your posts. Followers Only: Only followers can see posts.</small>
                </div>

                <div class="form-group">
                    <label for="avatar_url">Avatar URL (optional)</label>
                    <input
                        type="url"
                        id="avatar_url"
                        name="avatar_url"
                        value="<%= profile.avatar_url || '' %>"
                        placeholder="https://example.com/avatar.jpg"
                    >
                    <small>Leave empty to use default avatar</small>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <a href="/profiles/<%= profile.user_id %>" class="btn btn-secondary">Cancel</a>
                </div>
            </form>

            <!-- Preview section -->
            <div class="profile-preview">
                <h3>Preview</h3>
                <div class="profile-card">
                    <div class="profile-avatar-placeholder">ðŸ‘¤</div>
                    <h2>@<%= profile.handle %></h2>
                    <p class="profile-bio" id="preview-bio"><%= profile.bio || '' %></p>
                    <p>Visibility: <span id="preview-visibility"><%= profile.visibility === 'followers_only' ? 'Followers Only' : 'Public' %></span></p>
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <!-- EPIC_A.A1: Script externalizado para mejor mantenibilidad -->
    <script src="/js/profile.js"></script>
</body>
</html>
